#!/usr/bin/env bash

#
# Clair properties
#

# Directory to store the Clair configuration files
export CLAIR_CONF_DIR=${JOB_DIR}/config

# Directory to store the Clair log files
export CLAIR_LOG_DIR=${LOG_DIR}

# Directory to store the Clair process IDs
export CLAIR_PID_DIR=${RUN_DIR}

# Directory to store the Clair data files
export CLAIR_STORE_DIR=${STORE_DIR}

# Directory to store the Clair temp files
export CLAIR_TMP_DIR=${TMP_DIR}

# Clair Log Level
export CLAIR_LOG_LEVEL="<%= p('clair.log_level') %>"

# Type of the database to use
export CLAIR_DB_TYPE="<%= p('clair.db_type') %>"

# Path to the database to use
export CLAIR_DB_PATH="<%= p('clair.db_path', '${CLAIR_STORE_DIR}/clair.db') %>"

# Type of the notifier to use
export CLAIR_NOTIFIER_TYPE="<%= p('clair.notifier_type') %>"

# URL that will receive POST notifications
export CLAIR_NOTIFIER_HTTP_URL="<%= p('clair.notifier_http_url', '') %>"

# Frequency at which the vulnerability updater will run
export CLAIR_UPDATE_INTERVAL="<%= p('clair.update_interval') %>"

# Port on which the API will listen
export CLAIR_API_PORT="<%= p('clair.api_port') %>"

# Timeout of API calls
export CLAIR_API_TIMEOUT="<%= p('clair.api_timeout') %>"

<% if_p('clair.tls_cacert') do %>
# Path to CA for verifying TLS client certs
export CLAIR_API_CA_FILE="--api-ca-file=${CLAIR_CONF_DIR}/clair.cacert"
<% end %>

<% if_p('clair.tls_cert') do %>
# Path to TLS Cert file
export CLAIR_API_CERT_FILE="--api-cert-file=${CLAIR_CONF_DIR}/clair.cert"
<% end %>

<% if_p('clair.tls_key') do %>
# Path to TLS Key file
export CLAIR_API_KEY_FILE="-api-key-file=${CLAIR_CONF_DIR}/clair.key"
<% end %>

<% if p('clair.enable_cpu_profiling', false) %>
# Path to a write CPU profiling data
export CLAIR_CPU_PROFILE_PATH="--cpu-profile-path=${CLAIR_LOG_DIR}/cpu_profiling.data"
<% end %>
